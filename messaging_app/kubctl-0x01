#!/bin/bash

# Scale deployment to 3 replicas
echo "ðŸ” Scaling deployment to 3 replicas..."
kubectl scale deployment messaging-app --replicas=3

# Wait for pods to be ready
echo "â³ Waiting for all pods to be ready..."
sleep 5
kubectl get pods

# Load test using wrk
echo "ðŸš€ Running load test using wrk..."
MINIKUBE_URL=$(minikube service messaging-service --url)

# Install wrk if not installed
if ! command -v wrk &> /dev/null; then
    echo "ðŸ“¦ wrk not found, installing..."
    sudo apt update && sudo apt install -y wrk
fi

wrk -t4 -c20 -d10s "$MINIKUBE_URL"

# Show resource usage
echo "ðŸ“Š Monitoring resource usage..."
kubectl top pods
