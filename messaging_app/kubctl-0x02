#!/bin/bash

set -e

echo "ğŸŸ¦ Deploying BLUE version..."
kubectl apply -f blue_deployment.yaml

echo "ğŸŸ© Deploying GREEN version..."
kubectl apply -f green_deployment.yaml

echo "ğŸ”Œ Applying service (initially pointing to BLUE)..."
kubectl apply -f kubeservice.yaml

echo "â³ Waiting for pods to be ready..."
kubectl wait --for=condition=available --timeout=60s deployment/messaging-app-blue
kubectl wait --for=condition=available --timeout=60s deployment/messaging-app-green

echo "ğŸ“‹ Checking logs for GREEN version..."
GREEN_POD=$(kubectl get pods -l version=green -o jsonpath="{.items[0].metadata.name}")
kubectl logs "$GREEN_POD"

echo "âœ… Blue-Green setup applied successfully."
